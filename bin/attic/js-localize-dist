#! /bin/sh

if [ -f ./dist/config ]; then
    . ./dist/config
fi

if [ -z "$DIST_URL" ]; then
    echo "DIST_URL is not set.  You can set it manually or set it in "
         "a script at dist/config."
fi

version="$1"
version_dir="dist/$1"

# Make the bootstrap file for loading everything
function echo_load_js() {
    file="$1"
    echo "document.write('<script type=\"text/javascript\" " \
	 "src=\"$DIST_URL/$version/$file\"></script>');"
}

{
    echo "// This file was generated by js-new-dist for distribution" \
	 "version $version."
    echo "// ------------------------------------"

    echo "window.__dist_url__ = '$DIST_URL'"
    echo "window.__dist_version__ = '$version';"
    echo_load_js jmod.js
    echo_load_js dist.js    
} > "$version_dir/load.js"
